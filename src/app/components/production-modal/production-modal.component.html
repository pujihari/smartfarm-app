<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ data ? 'Edit Data Produksi' : 'Tambah Data Produksi' }}</h2>
      <button class="close-button" (click)="onClose()">Ã—</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="productionForm" (ngSubmit)="onSave()">
        <div class="form-group">
          <label for="flock_id">Flok</label>
          <select id="flock_id" formControlName="flock_id">
            <option [ngValue]="null" disabled>Pilih Flok</option>
            @for (flock of flocks; track flock.id) {
              <option [value]="flock.id">{{ flock.name }} ({{ flock.farmName }})</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label for="date">Tanggal</label>
          <input id="date" type="date" formControlName="date">
        </div>
        
        <fieldset class="egg-quality-group">
          <legend>Produksi Telur (butir)</legend>
          <div class="form-row">
            <div class="form-group">
              <label for="normal_eggs">Normal</label>
              <input id="normal_eggs" type="number" formControlName="normal_eggs">
            </div>
            <div class="form-group">
              <label for="white_eggs">Putih/Pucat</label>
              <input id="white_eggs" type="number" formControlName="white_eggs">
            </div>
            <div class="form-group">
              <label for="cracked_eggs">Retak</label>
              <input id="cracked_eggs" type="number" formControlName="cracked_eggs">
            </div>
          </div>
        </fieldset>

        <fieldset class="egg-quality-group">
          <legend>Produksi Telur (kilo)</legend>
          <div class="form-row">
            <div class="form-group">
              <label for="normal_eggs_weight_kg">Normal</label>
              <input id="normal_eggs_weight_kg" type="number" formControlName="normal_eggs_weight_kg">
            </div>
            <div class="form-group">
              <label for="white_eggs_weight_kg">Putih/Pucat</label>
              <input id="white_eggs_weight_kg" type="number" formControlName="white_eggs_weight_kg">
            </div>
            <div class="form-group">
              <label for="cracked_eggs_weight_kg">Retak</label>
              <input id="cracked_eggs_weight_kg" type="number" formControlName="cracked_eggs_weight_kg">
            </div>
          </div>
        </fieldset>

        <fieldset formArrayName="feed_consumption">
          <legend>Konsumsi Pakan</legend>
          @for (feed of feed_consumption.controls; track $index) {
            <div class="feed-row" [formGroupName]="$index">
              <select formControlName="feed_code">
                <option [ngValue]="''" disabled>Pilih Kode Pakan</option>
                @for (option of feedOptions; track option.item_code) {
                  <option [value]="option.item_code">{{ option.name }} ({{ option.item_code }})</option>
                }
              </select>
              <input type="number" formControlName="quantity_kg" placeholder="Jumlah (kg)">
              <button type="button" class="remove-feed-btn" (click)="removeFeed($index)" [disabled]="feed_consumption.controls.length <= 1">Hapus</button>
            </div>
          }
          <button type="button" class="add-feed-btn" (click)="addFeed()">+ Tambah Pakan</button>
        </fieldset>

        <div class="form-group">
          <label for="notes">Catatan (Opsional)</label>
          <textarea id="notes" formControlName="notes" rows="3" placeholder="Tambahkan catatan harian di sini..."></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" (click)="onClose()">Batal</button>
      <button class="save-btn" (click)="onSave()" [disabled]="productionForm.invalid">Simpan</button>
    </div>
  </div>
</div>