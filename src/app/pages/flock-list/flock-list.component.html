<div class="page-container">
  <div class="page-header">
    <h1 class="page-title">Manajemen Flok</h1>
    @if (authService.canWriteData$ | async) { <!-- Changed from isOwner$ -->
      <button class="add-button" (click)="openAddModal()">+ Tambah Flok Baru</button>
    }
  </div>

  <div class="table-container">
    <table class="flocks-table">
      <thead>
        <tr>
          <th>Nama Flok</th>
          <th>Nama Farm</th>
          <th>Jenis Ayam</th>
          <th>Populasi</th>
          <th>Tanggal Mulai</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        @if (flocks$ | async; as flocks) {
          @for (flock of flocks; track flock.id) {
            <tr>
              <td data-label="Nama Flok"><a [routerLink]="['/flocks', flock.id]" class="farm-link">{{ flock.name }}</a></td>
              <td data-label="Nama Farm"><a [routerLink]="['/farms', flock.farm_id]" class="farm-link">{{ flock.farmName }}</a></td>
              <td data-label="Jenis Ayam">{{ flock.breed }}</td>
              <td data-label="Populasi">{{ flock.population.toLocaleString('id-ID') }}</td>
              <td data-label="Tanggal Mulai">{{ flock.start_date | date: 'dd MMMM yyyy' }}</td>
              <td data-label="Status">
                <span class="status" [class.status-active]="flock.status === 'Aktif'" [class.status-finished]="flock.status === 'Selesai'">
                  {{ flock.status }}
                </span>
              </td>
              <td data-label="Aksi">
                <div class="action-buttons">
                  @if (authService.canWriteData$ | async) { <!-- Changed from isOwner$ -->
                    <button class="action-btn edit-btn" (click)="openEditModal(flock)">Edit</button>
                    <button class="action-btn delete-btn" (click)="openDeleteModal(flock)">Hapus</button>
                  }
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="7" class="empty-state">Belum ada data flok.</td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>
</div>

@if (isModalOpen) {
  <app-flock-modal 
    [flock]="flockToEdit" 
    [farms]="(farms$ | async) ?? []"
    (close)="closeModal()" 
    (save)="saveFlock($event)">
  </app-flock-modal>
}

@if (isConfirmModalOpen) {
  <app-confirmation-modal 
    (confirm)="confirmDelete()" 
    (cancel)="closeDeleteModal()">
  </app-confirmation-modal>
}